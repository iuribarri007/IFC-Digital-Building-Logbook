<div x-data="dblEnvData()">
    <!-- Thermal Envelope Facade -->
    <h2 @click="toggleAllEnvelopes" style="cursor: pointer;">
        Thermal Envelope Facade
        <span :class="{'arrow': true, 'down': isAllEnvelopesOpen()}">▶</span>
    </h2>

    <div x-show="isAllEnvelopesOpen()">
        <!-- Iterar sobre los niveles -->
        <template x-for="(envelopes, levelKey) in data" :key="levelKey">
            <div>
                <h2 @click="toggleLevel(levelKey)" style="cursor: pointer;">
                    <span x-text="'Level: ' + levelKey"></span>
                    <span :class="{'arrow': true, 'down': isLevelOpen(levelKey)}">▶</span>
                </h2>
                <div x-show="isLevelOpen(levelKey)" style="margin-left: 20px;">
                    <!-- Iterar sobre cada objeto en el nivel -->
                    <template x-for="(envelope, index) in envelopes" :key="index">
                        <div x-data="{ showEnvelope: false, showComponents: false }">
                            <h3 @click="toggleEnvelope(envelope)" style="cursor: pointer;">
                                <span x-text="'Envelope: ' + envelope.dblEnvelopeCode"></span>
                                <span :class="{'arrow': true, 'down': isEnvelopeOpen(envelope)}">▶</span>
                            </h3>
                            <div x-show="isEnvelopeOpen(envelope)" style="margin-left: 20px;">
                                <!-- Tabla para mostrar los atributos que comienzan por dblEnvelope -->
                                <table border="1">
                                    <thead>
                                        <tr>
                                            <th>Atributo</th>
                                            <th>Valor</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>dblEnvelopeCode</td>
                                            <td x-text="envelope.dblEnvelopeCode"></td>
                                        </tr>
                                        <tr>
                                            <td>dblEnvelopeType</td>
                                            <td x-text="envelope.dblEnvelopeType"></td>
                                        </tr>
                                        <tr>
                                            <td>dblEnvelopeUvalue</td>
                                            <td x-text="envelope.dblEnvelopeUvalue"></td>
                                        </tr>
                                        <tr>
                                            <td>dblEnvelopeWidth</td>
                                            <td x-text="envelope.dblEnvelopeWidth"></td>
                                        </tr>
                                    </tbody>
                                </table>

                                <!-- Tabla para iterar sobre dblEnvelopeComponents -->
                                <div style="margin-top: 20px;">
                                    <h4 @click="showComponents = !showComponents" style="cursor: pointer;">
                                        Components
                                        <span :class="{'arrow': true, 'down': showComponents}">▶</span>
                                    </h4>
                                    <div x-show="showComponents" style="margin-left: 20px;">
                                        <table border="1">
                                            <thead>
                                                <tr>
                                                    <th>dblComponentExpressId</th>
                                                    <th>dblComponentEntityType</th>
                                                    <th>dblComponentEnvelopeCode</th>
                                                    <th>dblComponentType</th>
                                                    <th>dblComponentRvalue</th>
                                                    <th>dblComponentNetArea</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <template x-for="component in envelope.dblEnvelopeComponents" :key="component.dblComponentExpressId">
                                                    <tr>
                                                        <td x-text="component.dblComponentExpressId"></td>
                                                        <td x-text="component.dblComponentEntityType"></td>
                                                        <td x-text="component.dblComponentEnvelopeCode"></td>
                                                        <td x-text="component.dblComponentType"></td>
                                                        <td x-text="component.dblComponentRvalue"></td>
                                                        <td x-text="component.dblComponentNetArea"></td>
                                                    </tr>
                                                </template>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <hr>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </template>
    </div>
</div>